[2025-12-10 16:55:46,594 INFO train.py line 136 4140853] => Loading config ...
[2025-12-10 16:55:46,594 INFO train.py line 138 4140853] Save path: /home/shsi/outputs/on_sbatch/small_drop47_density
[2025-12-10 16:55:47,115 INFO train.py line 139 4140853] Config:
weight = None
resume = False
evaluate = False
test_only = False
seed = 50126400
save_path = '/home/shsi/outputs/on_sbatch/small_drop47_density'
num_worker = 16
batch_size = 1
batch_size_val = None
batch_size_test = None
epoch = 200
eval_epoch = 10
clip_grad = 3.0
sync_bn = False
enable_amp = True
amp_dtype = 'bfloat16'
empty_cache = False
empty_cache_per_epoch = True
find_unused_parameters = False
enable_wandb = True
wandb_project = 'pointcept'
wandb_key = '8e059ab5df68865b71cfae546e75a48702a68d65'
mix_prob = 0
param_dicts = [
    dict(keyword='enc0.block0.', lr=0.00035451752478610026),
    dict(keyword='enc0.block1.', lr=0.00039390836087344473),
    dict(keyword='enc0.block2.', lr=0.00043767595652604966),
    dict(keyword='enc1.block0.', lr=0.0004863066183622774),
    dict(keyword='enc1.block1.', lr=0.0005403406870691972),
    dict(keyword='enc1.block2.', lr=0.0006003785411879967),
    dict(keyword='enc2.block0.', lr=0.000667087267986663),
    dict(keyword='enc2.block1.', lr=0.0007412080755407367),
    dict(keyword='enc2.block2.', lr=0.0008235645283785963),
    dict(keyword='enc3.block0.', lr=0.0009150716981984404),
    dict(keyword='enc3.block1.', lr=0.0010167463313316004),
    dict(keyword='enc3.block2.', lr=0.0011297181459240004),
    dict(keyword='enc3.block3.', lr=0.0012552423843600004),
    dict(keyword='enc3.block4.', lr=0.0013947137604000005),
    dict(keyword='enc3.block5.', lr=0.0015496819560000003),
    dict(keyword='enc3.block6.', lr=0.0017218688400000004),
    dict(keyword='enc3.block7.', lr=0.0019131876000000004),
    dict(keyword='enc3.block8.', lr=0.002125764),
    dict(keyword='enc3.block9.', lr=0.00236196),
    dict(keyword='enc3.block10.', lr=0.0026244000000000003),
    dict(keyword='enc3.block11.', lr=0.0029160000000000006),
    dict(keyword='enc4.block0.', lr=0.0032400000000000003),
    dict(keyword='enc4.block1.', lr=0.0036000000000000003),
    dict(keyword='enc4.block2.', lr=0.004)
]
hooks = [
    dict(type='CheckpointLoader'),
    dict(type='ModelHook'),
    dict(type='WeightDecaySchedular', base_value=0.04, final_value=0.2),
    dict(type='IterationTimer', warmup_iter=2),
    dict(type='InformationWriter'),
    dict(type='CheckpointSaver', save_freq=5)
]
train = dict(type='DefaultTrainer')
test = dict(type='SemSegTester', verbose=True)
num_points_per_step = 65536
grid_size = 0.1
dataset_type = 'NavarraDataset'
data_root = '/home/shsi/datasets/Point_Cloud/navarra17'
model = dict(
    type='Sonata-v1m1_density_ssl',
    backbone=dict(
        type='PT-v3m2',
        in_channels=6,
        order=('z', 'z-trans', 'hilbert', 'hilbert-trans'),
        stride=(2, 2, 2, 2),
        enc_depths=(3, 3, 3, 12, 3),
        enc_channels=(48, 96, 192, 384, 512),
        enc_num_head=(3, 6, 12, 24, 32),
        enc_patch_size=(1024, 1024, 1024, 1024, 1024),
        mlp_ratio=4,
        qkv_bias=True,
        qk_scale=None,
        attn_drop=0.0,
        proj_drop=0.0,
        drop_path=0.3,
        shuffle_orders=True,
        pre_norm=True,
        enable_rpe=False,
        enable_flash=True,
        upcast_attention=False,
        upcast_softmax=False,
        traceable=True,
        enc_mode=True,
        mask_token=True),
    teacher_custom=dict(attn_drop=0.0, proj_drop=0.0, drop_path=0.0),
    head_in_channels=1088,
    head_hidden_channels=4096,
    head_embed_channels=256,
    head_num_prototypes=4096,
    num_global_view=2,
    num_local_view=4,
    mask_size_start=0.4,
    mask_size_base=1.2,
    mask_size_warmup_ratio=0.05,
    mask_ratio_start=0.3,
    mask_ratio_base=0.7,
    mask_ratio_warmup_ratio=0.05,
    mask_jitter=0.01,
    teacher_temp_start=0.04,
    teacher_temp_base=0.07,
    teacher_temp_warmup_ratio=0.05,
    student_temp=0.1,
    density_loss_weight=0.01,
    mask_loss_weight=0.25,
    roll_mask_loss_weight=0.25,
    unmask_loss_weight=0.5,
    momentum_base=0.994,
    momentum_final=1,
    match_max_k=8,
    match_max_r=0.32,
    up_cast_level=2)
base_lr = 0.004
lr_decay = 0.9
base_wd = 0.04
final_wd = 0.2
optimizer = dict(type='AdamW', lr=0.004, weight_decay=0.04)
scheduler = dict(
    type='OneCycleLR',
    max_lr=[
        0.004, 0.00035451752478610026, 0.00039390836087344473,
        0.00043767595652604966, 0.0004863066183622774, 0.0005403406870691972,
        0.0006003785411879967, 0.000667087267986663, 0.0007412080755407367,
        0.0008235645283785963, 0.0009150716981984404, 0.0010167463313316004,
        0.0011297181459240004, 0.0012552423843600004, 0.0013947137604000005,
        0.0015496819560000003, 0.0017218688400000004, 0.0019131876000000004,
        0.002125764, 0.00236196, 0.0026244000000000003, 0.0029160000000000006,
        0.0032400000000000003, 0.0036000000000000003, 0.004
    ],
    pct_start=0.05,
    anneal_strategy='cos',
    div_factor=10.0,
    final_div_factor=1000.0)
transform = [
    dict(type='GridSample', grid_size=0.1, hash_type='fnv', mode='train'),
    dict(type='Copy', keys_dict=dict(coord='origin_coord')),
    dict(
        type='MultiViewGeneratorDesnitySSL',
        global_view_scale=(0.4, 1.0),
        local_view_scale=(0.1, 0.4),
        enable_density_simulation=True,
        student_drop_rate=(0.4, 0.7),
        view_keys=('coord', 'origin_coord', 'color'),
        global_view_num=2,
        local_view_num=4,
        global_shared_transform=[
            dict(
                type='RandomColorJitter',
                brightness=0.4,
                contrast=0.4,
                saturation=0.2,
                hue=0.02,
                p=0.8),
            dict(type='ChromaticTranslation', p=0.95, ratio=0.05)
        ],
        global_transform=[
            dict(type='CenterShift', apply_z=True),
            dict(type='RandomScale', scale=[0.8, 1.2]),
            dict(
                type='RandomRotate',
                angle=[-0.1, 0.1],
                axis='z',
                center=[0, 0, 0],
                p=0.8),
            dict(
                type='RandomRotate',
                angle=[-0.015625, 0.015625],
                axis='x',
                p=0.8),
            dict(
                type='RandomRotate',
                angle=[-0.015625, 0.015625],
                axis='y',
                p=0.8),
            dict(type='RandomFlip', p=0.5),
            dict(type='RandomJitter', sigma=0.05, clip=0.5)
        ],
        local_transform=[
            dict(type='CenterShift', apply_z=True),
            dict(type='RandomScale', scale=[0.8, 1.2]),
            dict(
                type='RandomRotate',
                angle=[-0.1, 0.1],
                axis='z',
                center=[0, 0, 0],
                p=0.8),
            dict(
                type='RandomRotate',
                angle=[-0.015625, 0.015625],
                axis='x',
                p=0.8),
            dict(
                type='RandomRotate',
                angle=[-0.015625, 0.015625],
                axis='y',
                p=0.8),
            dict(type='RandomFlip', p=0.5),
            dict(type='RandomJitter', sigma=0.05, clip=0.5),
            dict(
                type='RandomColorJitter',
                brightness=0.4,
                contrast=0.4,
                saturation=0.2,
                hue=0.02,
                p=0.8),
            dict(type='ChromaticTranslation', p=0.95, ratio=0.05)
        ],
        max_size=65536),
    dict(type='ToTensor'),
    dict(type='Update', keys_dict=dict(grid_size=0.1)),
    dict(
        type='Collect',
        keys=('global_origin_coord', 'global_coord', 'global_color',
              'global_offset', 'local_origin_coord', 'local_coord',
              'local_color', 'local_offset', 'grid_size', 'name',
              'sparse_coord', 'sparse_color', 'sparse_offset'),
        offset_keys_dict=dict(),
        global_feat_keys=('global_coord', 'global_color'),
        local_feat_keys=('local_coord', 'local_color'),
        sparse_feat_keys=('sparse_coord', 'sparse_color'))
]
data = dict(
    train=dict(
        type='NavarraDataset',
        split=('train', 'val'),
        data_root='/home/shsi/datasets/Point_Cloud/navarra17',
        transform=[
            dict(
                type='GridSample',
                grid_size=0.1,
                hash_type='fnv',
                mode='train'),
            dict(type='Copy', keys_dict=dict(coord='origin_coord')),
            dict(
                type='MultiViewGeneratorDesnitySSL',
                global_view_scale=(0.4, 1.0),
                local_view_scale=(0.1, 0.4),
                enable_density_simulation=True,
                student_drop_rate=(0.4, 0.7),
                view_keys=('coord', 'origin_coord', 'color'),
                global_view_num=2,
                local_view_num=4,
                global_shared_transform=[
                    dict(
                        type='RandomColorJitter',
                        brightness=0.4,
                        contrast=0.4,
                        saturation=0.2,
                        hue=0.02,
                        p=0.8),
                    dict(type='ChromaticTranslation', p=0.95, ratio=0.05)
                ],
                global_transform=[
                    dict(type='CenterShift', apply_z=True),
                    dict(type='RandomScale', scale=[0.8, 1.2]),
                    dict(
                        type='RandomRotate',
                        angle=[-0.1, 0.1],
                        axis='z',
                        center=[0, 0, 0],
                        p=0.8),
                    dict(
                        type='RandomRotate',
                        angle=[-0.015625, 0.015625],
                        axis='x',
                        p=0.8),
                    dict(
                        type='RandomRotate',
                        angle=[-0.015625, 0.015625],
                        axis='y',
                        p=0.8),
                    dict(type='RandomFlip', p=0.5),
                    dict(type='RandomJitter', sigma=0.05, clip=0.5)
                ],
                local_transform=[
                    dict(type='CenterShift', apply_z=True),
                    dict(type='RandomScale', scale=[0.8, 1.2]),
                    dict(
                        type='RandomRotate',
                        angle=[-0.1, 0.1],
                        axis='z',
                        center=[0, 0, 0],
                        p=0.8),
                    dict(
                        type='RandomRotate',
                        angle=[-0.015625, 0.015625],
                        axis='x',
                        p=0.8),
                    dict(
                        type='RandomRotate',
                        angle=[-0.015625, 0.015625],
                        axis='y',
                        p=0.8),
                    dict(type='RandomFlip', p=0.5),
                    dict(type='RandomJitter', sigma=0.05, clip=0.5),
                    dict(
                        type='RandomColorJitter',
                        brightness=0.4,
                        contrast=0.4,
                        saturation=0.2,
                        hue=0.02,
                        p=0.8),
                    dict(type='ChromaticTranslation', p=0.95, ratio=0.05)
                ],
                max_size=65536),
            dict(type='ToTensor'),
            dict(type='Update', keys_dict=dict(grid_size=0.1)),
            dict(
                type='Collect',
                keys=('global_origin_coord', 'global_coord', 'global_color',
                      'global_offset', 'local_origin_coord', 'local_coord',
                      'local_color', 'local_offset', 'grid_size', 'name',
                      'sparse_coord', 'sparse_color', 'sparse_offset'),
                offset_keys_dict=dict(),
                global_feat_keys=('global_coord', 'global_color'),
                local_feat_keys=('local_coord', 'local_color'),
                sparse_feat_keys=('sparse_coord', 'sparse_color'))
        ],
        test_mode=False,
        loop=20))
num_worker_per_gpu = 16
batch_size_per_gpu = 1
batch_size_val_per_gpu = 1
batch_size_test_per_gpu = 1

[2025-12-10 16:55:47,115 INFO train.py line 140 4140853] => Building model ...
[2025-12-10 16:55:49,030 INFO train.py line 241 4140853] Num params: 121577136
[2025-12-10 16:55:49,277 INFO train.py line 142 4140853] => Building writer ...
[2025-12-10 16:55:49,282 INFO train.py line 251 4140853] Tensorboard writer logging dir: /home/shsi/outputs/on_sbatch/small_drop47_density
[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/pointcept/utils/registry.py", line 53, in build_from_cfg
[rank0]:     return obj_cls(**args)
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/pointcept/engines/train.py", line 143, in __init__
[rank0]:     self.writer = self.build_writer()
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/pointcept/engines/train.py", line 254, in build_writer
[rank0]:     wandb.init(
[rank0]:   File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 1603, in init
[rank0]:     get_sentry().reraise(e)
[rank0]:   File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/wandb/analytics/sentry.py", line 190, in reraise
[rank0]:     raise exc.with_traceback(tb)
[rank0]:   File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 1524, in init
[rank0]:     wi.maybe_login(init_settings)
[rank0]:   File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 192, in maybe_login
[rank0]:     wandb_login._login(
[rank0]:   File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/wandb/sdk/wandb_login.py", line 323, in _login
[rank0]:     key, key_status = wlogin.prompt_api_key(referrer=referrer)
[rank0]:   File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/wandb/sdk/wandb_login.py", line 248, in prompt_api_key
[rank0]:     raise UsageError("api_key not configured (no-tty). call " + directive)
[rank0]: wandb.errors.errors.UsageError: api_key not configured (no-tty). call wandb.login(key=[your_api_key])

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/tools/train_torchrun.py", line 77, in <module>
[rank0]:     main()
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/tools/train_torchrun.py", line 74, in main
[rank0]:     main_worker(cfg)
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/tools/train_torchrun.py", line 16, in main_worker
[rank0]:     trainer = TRAINERS.build(dict(type=cfg.train.type, cfg=cfg))
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/pointcept/utils/registry.py", line 214, in build
[rank0]:     return self.build_func(*args, **kwargs, registry=self)
[rank0]:   File "/home/shsi/codes/ResiduePitsPointsAnalysis/pointcept/utils/registry.py", line 56, in build_from_cfg
[rank0]:     raise type(e)(f"{obj_cls.__name__}: {e}")
[rank0]: wandb.errors.errors.UsageError: Trainer: api_key not configured (no-tty). call wandb.login(key=[your_api_key])
[rank0]:[W1210 16:55:49.855008101 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
E1210 16:55:50.514000 4140850 site-packages/torch/distributed/elastic/multiprocessing/api.py:869] failed (exitcode: 1) local_rank: 0 (pid: 4140853) of binary: /home/shsi/.conda/envs/pointcept/bin/python
Traceback (most recent call last):
  File "/home/shsi/.conda/envs/pointcept/bin/torchrun", line 33, in <module>
    sys.exit(load_entry_point('torch==2.5.0', 'console_scripts', 'torchrun')())
  File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
    return f(*args, **kwargs)
  File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/torch/distributed/run.py", line 919, in main
    run(args)
  File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/torch/distributed/run.py", line 910, in run
    elastic_launch(
  File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 138, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/shsi/.conda/envs/pointcept/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 269, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
tools/train_torchrun.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2025-12-10_16:55:50
  host      : compute-3-16
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 4140853)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
